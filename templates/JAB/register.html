<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <title>JAP--register</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
    <link rel="stylesheet" href="/static/css/admin.css">
    <style>
        .send_sms {
            margin-left: 20px;
            color: #59b7a7;
        }
    </style>
</head>
<body>

<form class="layui-form" action="javascript:void(0);">
    <div class="layui-form-item">
        <img class="logo" src="/static/images/admin/logo.png"/>
        <div class="title">JAP</div>
        <div class="desc">
            --- JAP ESPACION DE -- Registre ---
        </div>
    </div>
    <div class="layui-form-item">
        <input name="nickname" type="text" lay-verify="required" placeholder="Usuario:" value="" hover class="layui-input"
               autocomplete="off"/>
    </div>
    <div class="layui-form-item">
        <input name="password" type="password" lay-verify="required" placeholder="Contraseña :" value="" hover
               class="layui-input"/>
    </div>
    <div class="layui-form-item">
        <input placeholder="Codigo de vertificacion : " name="captcha" lay-verify="required"
               hover class="code layui-input layui-input-inline"/>
        <img src="/static/images/admin/getCaptcha.png" class="codeImage" id="captchaImage"/>
    </div>
    <div class="layui-form-item">
        <input name="Email" type="text" lay-verify="required" placeholder="Email:" value="" hover
               class="code layui-input layui-input-inline"
               autocomplete="off"/>
        <!--点击发送短信-->
        <div class="layui-form-mid layui-word-aux"><a href="javascript:;" class="send_sms">Codigo vertificacion</a>
        </div>
    </div>
    <div class="layui-form-item">
        <input name="invitation_code" type="text" lay-verify="required" placeholder="Codigo:" value=""
               hover class="layui-input" autocomplete="off"/>
    </div>

    <div class="layui-form-item">
        <button class="layui-btn" lay-submit lay-filter="register">
            Registralo
        </button>
    </div>
    <div class="layui-form-item">
        <div class="layui-form-mid layui-word-aux">
            Ya tiene cuenta？ <a href="/login" style="color: #59b7a7;">log in</a>
        </div>
    </div>
</form>
<script src="/static/layui/layui.js"></script>

<script>
    let image_code_uuid = null;
    //
    // uuid 生成唯一标识符号，用来记录验证码
    function generateUUID() {
        var d = new Date().getTime();
        if (window.performance && typeof window.performance.now === 'function') {
            d += performance.now(); //use high-precision timer if available
        }
        var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,
            function(c) {
                var r = (d + Math.random() * 16) % 16 | 0;
                d = Math.floor(d / 16);
                return (c == 'x' ? r : (r & 0x3 | 0x8)).toString(16);
            });
        return uuid;
    }
    //
    function generateChapter() {
        image_code_uuid = generateUUID();
        // console.log(generateUUID())

    }   //'jquery'

    layui.use  (  ['form', 'layer'], function() {
        let $ = layui.jquery;
        // let form = layui.form;
        // 请求后端生成图片验证码
        generateChapter();
        document.getElementById('captchaImage').src = '/get_captcha?image_code_uuid=' + image_code_uuid;
        // 点击图片,生成新的验证码
        $('#captchaImage').click(function() {
            generateChapter();
        });
    //    点击发送短信验证码
   // 1 获得邮箱号，校验
//    2 发送请求
        $('.send_sms').click(function () {
            // {#发送收集短信#}
            console.log('请求发送短信pedir(envia) el mensaje');
            let data = {
                captcha_code: $('[name="captcha"]').val(),
                captcha_code_uuid: image_code_uuid,
                mobile: $('[name="Email"]').val(),
            };
            const options = {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            };

            fetch('/sms_code', options).then(function (response) {
                return response.json();
            }).then(function (result) {
                // {#console.log(result);#}
                if (result.status === 'fail') {
                    // {#代表发送失败#}
                    layer.msg(result.message);
                } else {
                    layer.msg(result.message);
                    // {#代表发送成功#}
                    var num = 60;
                    var t = setInterval(function () {
                        // {#代表倒计时结束#}
                        if (num === 1) {
                            // {#清除倒计时#}
                            clearInterval(t);
                            // {#设置显示内容#}
                            $('.send_sms').html('Codigo de vertificacion');
                            // {#添加点击事件#}
                            // $('.send_sms').attr('onclick', 'sendSMSCode();');
                        } else {
                            num -= 1;
                            // {#设置 a 标签显示的内容#}
                            $('.send_sms').html(num + '秒');
                        }
                    }, 1000);
                }
            });
        });
    });

</script>
<!--<script src="/static/js/main.js"></script>-->
<!--<script src="/static/js/bbs/register.js"></script>-->
</body>
</html>
